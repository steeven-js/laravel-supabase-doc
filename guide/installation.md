# üöÄ Installation

Guide d'installation complet pour configurer l'environnement Laravel-Supabase de A √† Z.

## üìã Vue d'ensemble

Ce guide vous accompagne dans l'installation compl√®te du projet Laravel-Supabase, depuis les pr√©requis jusqu'√† la v√©rification finale.

### üéØ Objectifs

- **Installer tous les pr√©requis** n√©cessaires
- **Configurer l'environnement** de d√©veloppement
- **D√©marrer les services** Docker
- **V√©rifier l'installation** et tester l'application

---

## üîß Pr√©requis

### Syst√®me d'exploitation

| OS | Version minimum | Recommand√© |
|----|-----------------|------------|
| **Ubuntu** | 20.04 LTS | 22.04 LTS |
| **macOS** | 11.0 (Big Sur) | 13.0+ (Ventura) |
| **Windows** | 10 Pro/Enterprise | 11 Pro + WSL2 |

### Ressources syst√®me

| Composant | Minimum | Recommand√© |
|-----------|---------|------------|
| **RAM** | 4 GB | 8 GB+ |
| **CPU** | 2 cores | 4+ cores |
| **Stockage** | 10 GB libre | 20 GB+ SSD |
| **R√©seau** | Connexion Internet | Haut d√©bit |

---

## üì¶ Installation des d√©pendances

### 1. Docker et Docker Compose

#### Ubuntu/Debian
```bash
# Mise √† jour du syst√®me
sudo apt update && sudo apt upgrade -y

# Installation Docker
curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh get-docker.sh

# Installation Docker Compose
sudo apt install docker-compose-plugin

# Ajouter l'utilisateur au groupe docker
sudo usermod -aG docker $USER

# Red√©marrer la session (ou se d√©connecter/reconnecter)
newgrp docker

# V√©rifier l'installation
docker --version
docker compose version
```

#### macOS
```bash
# Installer Docker Desktop pour Mac
# T√©l√©charger depuis : https://www.docker.com/products/docker-desktop

# Ou avec Homebrew
brew install --cask docker

# D√©marrer Docker Desktop et v√©rifier
docker --version
docker compose version
```

#### Windows (WSL2)
```powershell
# Installer WSL2 d'abord
wsl --install

# Installer Docker Desktop pour Windows
# T√©l√©charger depuis : https://www.docker.com/products/docker-desktop

# V√©rifier dans WSL2
docker --version
docker compose version
```

### 2. Git

#### Ubuntu/Debian
```bash
sudo apt install git -y
git --version
```

#### macOS
```bash
# Git est g√©n√©ralement pr√©-install√©
# Ou avec Homebrew
brew install git
git --version
```

#### Windows
```bash
# Dans WSL2
sudo apt install git -y
git --version
```

### 3. Node.js (pour les assets frontend)

#### Ubuntu/Debian
```bash
# Installation Node.js 18 LTS
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt install nodejs -y

# V√©rifier l'installation
node --version
npm --version
```

#### macOS
```bash
# Avec Homebrew
brew install node@18

# Ou avec nvm (recommand√©)
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash
nvm install 18
nvm use 18
```

#### Windows (WSL2)
```bash
# Dans WSL2
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt install nodejs -y
```

---

## üìÅ Clonage du projet

### 1. Cloner les repositories

```bash
# Cr√©er un dossier de travail
mkdir ~/laravel-supabase-project
cd ~/laravel-supabase-project

# Cloner le repository principal
git clone https://github.com/steeven-js/laravel-supabase.git

# Cloner le repository Supabase officiel
git clone --depth 1 https://github.com/supabase/supabase

# Structure finale
# ~/laravel-supabase-project/
# ‚îú‚îÄ‚îÄ laravel-supabase/          # Application principale
# ‚îî‚îÄ‚îÄ supabase/                  # Code source Supabase
```

### 2. Pr√©parer les projets Supabase

```bash
# Cr√©er les dossiers pour les environnements Supabase
mkdir supabase-project-dev      # D√©veloppement
mkdir supabase-project          # Production

# Copier les fichiers de configuration Supabase
cp -r supabase/docker/* supabase-project-dev/
cp -r supabase/docker/* supabase-project/

# Copier les fichiers d'environnement
cp supabase/docker/.env.example supabase-project-dev/.env
cp supabase/docker/.env.example supabase-project/.env
```

---

## ‚öôÔ∏è Configuration

### 1. Configuration Laravel

```bash
cd laravel-supabase

# Copier le fichier d'environnement
cp .env.example .env

# G√©n√©rer la cl√© d'application Laravel
docker run --rm -v $(pwd):/app -w /app php:8.4-cli php artisan key:generate --show

# Ou si vous avez PHP install√© localement
php artisan key:generate
```

### 2. Configuration Supabase d√©veloppement

```bash
cd ../supabase-project-dev

# √âditer le fichier .env
nano .env
```

**Contenu du fichier `.env` (d√©veloppement) :**
```env
############
# Secrets
# YOU MUST CHANGE THESE BEFORE GOING INTO PRODUCTION
############

POSTGRES_PASSWORD=your-super-secret-and-long-postgres-password
JWT_SECRET=your-super-secret-jwt-token-with-at-least-32-characters-long
ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZS1kZW1vIiwicm9sZSI6ImFub24iLCJleHAiOjE5ODM4MTI5OTZ9.CRXP1A7WOeoJeXxjNni43kdQwgnWNReilDMblYTn_I0
SERVICE_ROLE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZS1kZW1vIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImV4cCI6MTk4MzgxMjk5Nn0.EGIM96RAZx35lJzdJsyH-qQwv8Hdp7fsn3W0YpN81IU

############
# Database
############

POSTGRES_HOST=db
POSTGRES_DB=postgres
POSTGRES_PORT=5432
POSTGRES_USER=postgres

############
# API Proxy
############

KONG_HTTP_PORT=8000
KONG_HTTPS_PORT=8443

############
# API
############

API_EXTERNAL_URL=http://localhost:8000

############
# Auth
############

SITE_URL=http://localhost:8080
ADDITIONAL_REDIRECT_URLS=
JWT_EXPIRY=3600
DISABLE_SIGNUP=false
API_EXTERNAL_URL=http://localhost:8000

############
# Studio
############

STUDIO_DEFAULT_ORGANIZATION=Default Organization
STUDIO_DEFAULT_PROJECT=Default Project

STUDIO_PORT=3000
# replace if you intend to use Studio outside of localhost
SUPABASE_PUBLIC_URL=http://localhost:8000

############
# Misc
############

ENABLE_EMAIL_SIGNUP=true
ENABLE_EMAIL_AUTOCONFIRM=true
ENABLE_PHONE_SIGNUP=true
ENABLE_PHONE_AUTOCONFIRM=true
```

### 3. Configuration Supabase production

```bash
cd ../supabase-project

# Copier la configuration de dev comme base
cp ../supabase-project-dev/.env .env

# Modifier pour la production
nano .env
```

**Modifications pour la production :**
```env
# Changer les secrets (IMPORTANT!)
POSTGRES_PASSWORD=your-production-super-secret-password
JWT_SECRET=your-production-super-secret-jwt-token

# URLs de production
SITE_URL=https://your-domain.com
API_EXTERNAL_URL=https://your-supabase-domain.com
SUPABASE_PUBLIC_URL=https://your-supabase-domain.com

# D√©sactiver l'auto-confirmation
ENABLE_EMAIL_AUTOCONFIRM=false
ENABLE_PHONE_AUTOCONFIRM=false
```

### 4. Configuration Laravel avec Supabase

```bash
cd ../laravel-supabase

# √âditer le fichier .env
nano .env
```

**Ajouter les variables Supabase :**
```env
# Configuration Supabase
SUPABASE_URL=http://localhost:8000
SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZS1kZW1vIiwicm9sZSI6ImFub24iLCJleHAiOjE5ODM4MTI5OTZ9.CRXP1A7WOeoJeXxjNni43kdQwgnWNReilDMblYTn_I0
SUPABASE_SERVICE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZS1kZW1vIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImV4cCI6MTk4MzgxMjk5Nn0.EGIM96RAZx35lJzdJsyH-qQwv8Hdp7fsn3W0YpN81IU

# Configuration Docker
UID=1000
GID=1000
NGINX_PORT=8080
VITE_PORT=5173

# Configuration XDebug (d√©veloppement)
XDEBUG_ENABLED=true
XDEBUG_HOST=host.docker.internal
XDEBUG_IDE_KEY=VSCODE
```

---

## üöÄ D√©marrage des services

### 1. D√©marrer Supabase (d√©veloppement)

```bash
cd ~/laravel-supabase-project/supabase-project-dev

# T√©l√©charger les images Docker
docker compose pull

# D√©marrer tous les services Supabase
docker compose up -d

# V√©rifier que tous les services sont d√©marr√©s
docker compose ps

# Attendre que tous les services soient "healthy"
echo "‚è≥ Attente du d√©marrage de Supabase..."
sleep 30

# V√©rifier les logs si n√©cessaire
docker compose logs kong
```

### 2. D√©marrer Laravel

```bash
cd ~/laravel-supabase-project/laravel-supabase

# T√©l√©charger et construire les images
docker compose -f compose.dev.yaml build

# D√©marrer l'application Laravel
docker compose -f compose.dev.yaml up -d

# V√©rifier l'√©tat des services
docker compose -f compose.dev.yaml ps
```

### 3. Installation des d√©pendances

```bash
# Installer les d√©pendances PHP
docker compose -f compose.dev.yaml exec workspace composer install

# Installer les d√©pendances JavaScript
docker compose -f compose.dev.yaml exec workspace npm install

# G√©n√©rer la cl√© d'application (si pas fait)
docker compose -f compose.dev.yaml exec php-fpm php artisan key:generate

# Lancer les migrations (si n√©cessaire)
docker compose -f compose.dev.yaml exec php-fpm php artisan migrate

# Compiler les assets pour le d√©veloppement
docker compose -f compose.dev.yaml exec workspace npm run dev
```

---

## ‚úÖ V√©rification de l'installation

### 1. V√©rifier les services

```bash
# V√©rifier tous les conteneurs Laravel
docker compose -f compose.dev.yaml ps

# V√©rifier tous les conteneurs Supabase
cd ../supabase-project-dev
docker compose ps

# Retourner dans Laravel
cd ../laravel-supabase
```

**Sortie attendue :**
```
‚úÖ Tous les services doivent √™tre "Up" et "healthy"
```

### 2. Tester les URLs

```bash
# Tester l'application Laravel
curl -I http://localhost:8080

# Tester Supabase Studio
curl -I http://localhost:8000

# Tester l'API Supabase
curl -H "apikey: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZS1kZW1vIiwicm9sZSI6ImFub24iLCJleHAiOjE5ODM4MTI5OTZ9.CRXP1A7WOeoJeXxjNni43kdQwgnWNReilDMblYTn_I0" \
     http://localhost:8000/rest/v1/
```

### 3. Acc√®s aux interfaces

**Laravel Application :**
- URL : http://localhost:8080
- Status : Page d'accueil Laravel

**Supabase Studio :**
- URL : http://localhost:8000
- Username : `supabase`
- Password : `this_password_is_insecure_and_should_be_updated`

**Vite Dev Server :**
- URL : http://localhost:5173
- Status : Hot Module Replacement actif

---

## üîß Configuration avanc√©e

### 1. Configuration IDE (VS Code)

**Extensions recommand√©es :**
```bash
# Installer les extensions VS Code
code --install-extension ms-vscode-remote.remote-containers
code --install-extension bradlc.vscode-tailwindcss
code --install-extension bmewburn.vscode-intelephense-client
code --install-extension ms-vscode.vscode-typescript-next
```

**Configuration XDebug :**
```json
// .vscode/launch.json
{
    "version": "0.2.0",
    "configurations": [
        {
            "name": "Listen for XDebug",
            "type": "php",
            "request": "launch",
            "port": 9003,
            "pathMappings": {
                "/var/www": "${workspaceFolder}"
            }
        }
    ]
}
```

### 2. Aliases pratiques

```bash
# Ajouter √† ~/.bashrc ou ~/.zshrc
echo '
# Laravel Supabase Aliases
alias lsdev="cd ~/laravel-supabase-project/laravel-supabase && docker compose -f compose.dev.yaml"
alias lsworkspace="docker compose -f compose.dev.yaml exec workspace"
alias lsartisan="docker compose -f compose.dev.yaml exec php-fpm php artisan"
alias lscomposer="docker compose -f compose.dev.yaml exec php-fpm composer"
alias lsnpm="docker compose -f compose.dev.yaml exec workspace npm"

# Supabase Aliases
alias supadev="cd ~/laravel-supabase-project/supabase-project-dev && docker compose"
alias supaprod="cd ~/laravel-supabase-project/supabase-project && docker compose"
' >> ~/.bashrc

# Recharger le shell
source ~/.bashrc
```

### 3. Scripts utiles

**Script de d√©marrage complet :**
```bash
#!/bin/bash
# start-dev.sh

echo "üöÄ D√©marrage environnement Laravel-Supabase..."

# V√©rifier que Docker fonctionne
if ! docker info > /dev/null 2>&1; then
    echo "‚ùå Docker n'est pas d√©marr√©"
    exit 1
fi

# D√©marrer Supabase
echo "üìä D√©marrage Supabase..."
cd ~/laravel-supabase-project/supabase-project-dev
docker compose up -d

# Attendre que Supabase soit pr√™t
echo "‚è≥ Attente Supabase (30s)..."
sleep 30

# D√©marrer Laravel
echo "üé® D√©marrage Laravel..."
cd ~/laravel-supabase-project/laravel-supabase
docker compose -f compose.dev.yaml up -d

# Attendre que Laravel soit pr√™t
echo "‚è≥ Attente Laravel (10s)..."
sleep 10

# V√©rifier l'√©tat
echo "‚úÖ V√©rification des services..."
docker compose -f compose.dev.yaml ps

echo "üéâ Environnement pr√™t !"
echo "üì± Laravel: http://localhost:8080"
echo "üìä Supabase: http://localhost:8000"
```

**Rendre le script ex√©cutable :**
```bash
chmod +x start-dev.sh
```

---

## üö® D√©pannage

### Probl√®mes courants

| Probl√®me | Sympt√¥me | Solution |
|----------|----------|----------|
| **Port 8080 occup√©** | `bind: address already in use` | `sudo lsof -ti:8080 \| xargs kill -9` |
| **Permission denied** | `permission denied while trying to connect` | `sudo usermod -aG docker $USER && newgrp docker` |
| **Out of space** | `no space left on device` | `docker system prune -a --volumes` |
| **Build failed** | `failed to build` | `docker compose build --no-cache` |

### Commandes de diagnostic

```bash
# V√©rifier l'installation Docker
docker --version && docker compose version

# V√©rifier les services qui tournent
docker ps

# V√©rifier l'espace disque Docker
docker system df

# Voir les logs d'un service
docker compose logs service-name

# R√©initialiser compl√®tement
docker compose down -v
docker system prune -a --volumes
```

### Logs utiles

```bash
# Logs Laravel
docker compose -f compose.dev.yaml logs php-fpm
docker compose -f compose.dev.yaml logs web

# Logs Supabase
cd ../supabase-project-dev
docker compose logs kong
docker compose logs auth
docker compose logs rest

# Logs syst√®me Docker
sudo journalctl -u docker.service
```

---

## üéâ Prochaines √©tapes

### 1. Explorer l'application

- ‚úÖ **Page d'accueil** : http://localhost:8080
- ‚úÖ **Supabase Studio** : http://localhost:8000
- ‚úÖ **Documentation** : Consultez les autres guides

### 2. D√©veloppement

- üìñ **[Guide de configuration](./configuration)** - Personnaliser l'application
- üê≥ **[Commandes Docker](../docker/commands)** - Ma√Ætriser Docker
- üóÑÔ∏è **[Configuration Supabase](../supabase/configuration)** - Approfondir Supabase

### 3. Production

- üè≠ **[D√©ploiement production](../deployment/production)** - Mise en ligne
- üîí **[SSL/HTTPS](../deployment/ssl)** - S√©curiser l'application

---

## üìû Support

### En cas de probl√®me

1. **V√©rifiez les logs** avec les commandes ci-dessus
2. **Consultez la documentation** des composants
3. **Ouvrez une issue** sur GitHub avec les logs
4. **Rejoignez la communaut√©** pour obtenir de l'aide

### Ressources utiles

- üêô **Repository** : https://github.com/steeven-js/laravel-supabase
- üìö **Documentation** : https://laravel-supabase-docs.vercel.app
- üí¨ **Discussions** : Section GitHub Discussions

---

**üéä F√©licitations ! Votre environnement Laravel-Supabase est maintenant pr√™t !** 