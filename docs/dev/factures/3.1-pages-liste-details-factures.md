# Module 3.1 : Pages Liste et D√©tails Factures - Interface React

## üìã Vue d'ensemble

Ce module documente les pages React frontend pour la gestion des factures : la page liste (`index.tsx`) avec tableau avanc√© et m√©triques, et la page d√©tail (`show.tsx`) avec interface professionnelle et gestion des statuts.

## üèóÔ∏è Architecture des Pages

### Structure des Composants

```
pages/factures/
‚îú‚îÄ‚îÄ index.tsx           # Page liste avec tableau et filtres
‚îú‚îÄ‚îÄ show.tsx            # Page d√©tail avec actions contextuelles
‚îú‚îÄ‚îÄ create.tsx          # Formulaire de cr√©ation
‚îú‚îÄ‚îÄ edit.tsx            # Formulaire d'√©dition
‚îî‚îÄ‚îÄ envoyer-email.tsx   # Interface d'envoi email
```

### Interfaces TypeScript

```typescript
interface Facture {
    id: number;
    numero_facture: string;
    client: {
        id: number;
        nom: string;
        prenom: string;
        email: string;
        telephone?: string;
        entreprise?: {
            id: number;
            nom: string;
            nom_commercial?: string;
        };
    };
    devis?: {
        id: number;
        numero_devis: string;
    };
    administrateur?: {
        id: number;
        name: string;
        email: string;
    };
    objet: string;
    description?: string;
    statut: 'brouillon' | 'en_attente' | 'envoyee' | 'payee' | 'en_retard' | 'annulee';
    date_facture: string;
    date_echeance: string;
    date_paiement?: string;
    montant_ht: number;
    montant_ttc: number;
    taux_tva: number;
    lignes: LigneFacture[];
}

interface LigneFacture {
    id: number;
    service_id?: number;
    quantite: number;
    prix_unitaire_ht: number;
    taux_tva: number;
    montant_ht: number;
    montant_tva: number;
    montant_ttc: number;
    ordre: number;
    description_personnalisee?: string;
    service?: {
        id: number;
        nom: string;
        description: string;
        code?: string;
        unite?: string;
    };
}
```

## üìä Page Liste - index.tsx (870+ lignes)

### üéØ Fonctionnalit√©s Principales

1. **üìà M√©triques Temps R√©el** : 6 cartes de KPIs avec montants et volumes
2. **üîç Filtrage Avanc√©** : Recherche, statut, p√©riode, d√©lais
3. **üìã Tableau Interactif** : Tri, pagination, s√©lection multiple
4. **üé® Badges de Statut** : Couleurs et ic√¥nes contextuelles
5. **‚ö° Actions Bulk** : Suppression, export en masse
6. **üì± Responsive Design** : Adaptatif mobile et desktop

### M√©triques Dashboard

```typescript
// Calcul des m√©triques temps r√©el par p√©riode
const metrics = useMemo(() => {
    const totalFactures = filteredFacturesByPeriod.length;
    const totalMontant = filteredFacturesByPeriod.reduce((sum, item) => sum + item.montant_ttc, 0);

    const payeeFactures = filteredFacturesByPeriod.filter(item => item.statut === 'payee');
    const envoyeeFactures = filteredFacturesByPeriod.filter(item => item.statut === 'envoyee');
    const retardFactures = filteredFacturesByPeriod.filter(item => item.statut === 'en_retard');
    const annuleeFactures = filteredFacturesByPeriod.filter(item => item.statut === 'annulee');
    const brouillonFactures = filteredFacturesByPeriod.filter(item => item.statut === 'brouillon');

    return {
        total: { count: totalFactures, montant: totalMontant },
        payee: { count: payeeFactures.length, montant: payeeFactures.reduce((sum, item) => sum + item.montant_ttc, 0) },
        envoyee: { count: envoyeeFactures.length, montant: envoyeeFactures.reduce((sum, item) => sum + item.montant_ttc, 0) },
        retard: { count: retardFactures.length, montant: retardFactures.reduce((sum, item) => sum + item.montant_ttc, 0) },
        annulee: { count: annuleeFactures.length, montant: annuleeFactures.reduce((sum, item) => sum + item.montant_ttc, 0) },
        brouillon: { count: brouillonFactures.length, montant: brouillonFactures.reduce((sum, item) => sum + item.montant_ttc, 0) }
    };
}, [filteredFacturesByPeriod]);
```

### Cartes M√©triques avec D√©grad√©s

```tsx
{/* Grid des 6 m√©triques principales */}
<div className="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-6 gap-4">
    {/* Total */}
    <Card className="bg-gradient-to-br from-blue-50 to-blue-100 dark:from-blue-950 dark:to-blue-900 border-blue-200 dark:border-blue-800">
        <CardContent className="p-4">
            <div className="flex items-center justify-between">
                <div>
                    <p className="text-sm font-medium text-blue-600 dark:text-blue-400">Total</p>
                    <p className="text-xs text-blue-500 dark:text-blue-300 mb-1">
                        {metrics.total.count} factures
                    </p>
                    <p className="text-2xl font-bold text-blue-700 dark:text-blue-100">
                        {formatPrice(metrics.total.montant)}
                    </p>
                </div>
                <div className="w-12 h-12 bg-blue-100 dark:bg-blue-800 rounded-lg flex items-center justify-center">
                    <TrendingUp className="h-6 w-6 text-blue-600 dark:text-blue-300" />
                </div>
            </div>
        </CardContent>
    </Card>

    {/* Pay√©es */}
    <Card className="bg-gradient-to-br from-green-50 to-green-100 dark:from-green-950 dark:to-green-900 border-green-200 dark:border-green-800">
        <CardContent className="p-4">
            <div className="flex items-center justify-between">
                <div>
                    <p className="text-sm font-medium text-green-600 dark:text-green-400">Pay√©es</p>
                    <p className="text-xs text-green-500 dark:text-green-300 mb-1">
                        {metrics.payee.count} factures
                    </p>
                    <p className="text-2xl font-bold text-green-700 dark:text-green-100">
                        {formatPrice(metrics.payee.montant)}
                    </p>
                </div>
                <div className="w-12 h-12 bg-green-100 dark:bg-green-800 rounded-lg flex items-center justify-center">
                    <CheckCircle className="h-6 w-6 text-green-600 dark:text-green-300" />
                </div>
            </div>
        </CardContent>
    </Card>

    {/* En attente (orange) */}
    <Card className="bg-gradient-to-br from-orange-50 to-orange-100">
        {/* ... En attente de paiement ... */}
    </Card>

    {/* En retard (rouge) */}
    <Card className="bg-gradient-to-br from-red-50 to-red-100">
        {/* ... Paiements en retard ... */}
    </Card>

    {/* Annul√©es (violet) */}
    <Card className="bg-gradient-to-br from-purple-50 to-purple-100">
        {/* ... Factures annul√©es ... */}
    </Card>

    {/* Brouillons (gris) */}
    <Card className="bg-gradient-to-br from-gray-50 to-gray-100">
        {/* ... Factures brouillons ... */}
    </Card>
</div>
```

### Filtres de P√©riode Intelligents

```tsx
// Filtrage par p√©riode avec √©tat React
const [periodFilter, setPeriodFilter] = useState<'tous' | 'annee_courante' | 'mois_courant'>('mois_courant');

// Logique de filtrage par date
const filteredFacturesByPeriod = useMemo(() => {
    return factures.filter(item => {
        const itemDate = new Date(item.date_facture);

        switch (periodFilter) {
            case 'tous':
                return true;
            case 'annee_courante':
                return itemDate.getFullYear() === currentYear;
            case 'mois_courant':
                return itemDate.getFullYear() === currentYear &&
                    itemDate.getMonth() + 1 === currentMonth;
            default:
                return true;
        }
    });
}, [factures, periodFilter, currentYear, currentMonth]);

// S√©lecteur UI avec ic√¥nes
<Select value={periodFilter} onValueChange={setPeriodFilter}>
    <SelectContent>
        <SelectItem value="tous">üìà Tous</SelectItem>
        <SelectItem value="annee_courante">üìÖ Ann√©e en cours</SelectItem>
        <SelectItem value="mois_courant">üí∞ Mois en cours</SelectItem>
    </SelectContent>
</Select>
```

### Syst√®me de Badges de Statut

```tsx
// Styles contextuels par statut
const getStatusStyles = (statut: string) => {
    switch (statut) {
        case 'payee':
            return 'bg-green-100 text-green-800 border-green-200';
        case 'envoyee':
            return 'bg-blue-100 text-blue-800 border-blue-200';
        case 'en_retard':
            return 'bg-red-100 text-red-800 border-red-200';
        case 'annulee':
            return 'bg-gray-100 text-gray-800 border-gray-200';
        case 'brouillon':
            return 'bg-gray-100 text-gray-800 border-gray-200';
        case 'en_attente':
            return 'bg-yellow-100 text-yellow-800 border-yellow-200';
        default:
            return 'bg-gray-100 text-gray-800 border-gray-200';
    }
};

// Ic√¥nes par statut
const getStatusIcon = (statut: string) => {
    switch (statut) {
        case 'payee':
            return <CheckCircle className="h-4 w-4" />;
        case 'envoyee':
            return <Clock className="h-4 w-4" />;
        case 'en_retard':
            return <AlertCircle className="h-4 w-4" />;
        case 'annulee':
            return <XCircle className="h-4 w-4" />;
        case 'brouillon':
            return <FileText className="h-4 w-4" />;
        case 'en_attente':
            return <Clock className="h-4 w-4" />;
        default:
            return <Receipt className="h-4 w-4" />;
    }
};

// Badge uniforme dans le tableau
<Badge className={`${getStatusStyles(facture.statut)} border-0`}>
    <span className="flex items-center gap-1">
        {getStatusIcon(facture.statut)}
        {formatStatut(facture.statut)}
    </span>
</Badge>
```

### Tableau avec Tri et Pagination

```tsx
// √âtat de tri multi-colonnes
const [sortField, setSortField] = useState<keyof Facture>('numero_facture');
const [sortDirection, setSortDirection] = useState<'asc' | 'desc'>('desc');

// Gestion du tri intelligent
const handleSort = (field: keyof Facture) => {
    if (sortField === field) {
        setSortDirection(sortDirection === 'asc' ? 'desc' : 'asc');
    } else {
        setSortField(field);
        setSortDirection('asc');
    }
};

// Tri avec gestion des types
filtered.sort((a, b) => {
    let aValue = a[sortField];
    let bValue = b[sortField];

    if (sortField === 'numero_facture' || sortField === 'objet') {
        aValue = (aValue as string).toLowerCase();
        bValue = (bValue as string).toLowerCase();
    }

    // G√©rer les valeurs undefined/null
    if (aValue == null && bValue == null) return 0;
    if (aValue == null) return sortDirection === 'asc' ? 1 : -1;
    if (bValue == null) return sortDirection === 'asc' ? -1 : 1;

    if (aValue < bValue) return sortDirection === 'asc' ? -1 : 1;
    if (aValue > bValue) return sortDirection === 'asc' ? 1 : -1;
    return 0;
});

// Headers cliquables
<TableHead className="cursor-pointer sort-button" onClick={() => handleSort('numero_facture')}>
    <div className="flex items-center gap-2">
        Num√©ro
        <ArrowUpDown className="h-4 w-4" />
    </div>
</TableHead>
```

### Actions en Masse et Export

```tsx
// S√©lection multiple avec √©tats
const [selectedFactures, setSelectedFactures] = useState<number[]>([]);

// S√©lection/d√©s√©lection globale
const handleSelectAll = (checked: boolean) => {
    if (checked) {
        setSelectedFactures(paginatedFactures.map(item => item.id));
    } else {
        setSelectedFactures([]);
    }
};

// Actions bulk conditionnelles
{selectedFactures.length > 0 && (
    <div className="form-actions">
        <Button variant="outline" size="sm" onClick={handleDeleteSelected}>
            <Trash2 className="mr-2 h-4 w-4" />
            Supprimer ({selectedFactures.length})
        </Button>
        <Button variant="outline" size="sm">
            <Download className="mr-2 h-4 w-4" />
            Exporter
        </Button>
    </div>
)}
```

### Gestion des Retards de Paiement

```tsx
// D√©tection automatique des retards
const isRetard = (dateEcheance: string, statut: string) => {
    return new Date(dateEcheance) < new Date() &&
        !['payee', 'annulee'].includes(statut);
};

// Affichage conditionnel dans le tableau
<TableCell>
    <div className={isRetard(facture.date_echeance, facture.statut) ? 'text-red-600 font-medium' : ''}>
        {formatDate(facture.date_echeance)}
        {isRetard(facture.date_echeance, facture.statut) && (
            <div className="text-xs text-red-500">En retard</div>
        )}
    </div>
</TableCell>
```

## üîç Page D√©tail - show.tsx (990+ lignes)

### üéØ Interface Professionnelle

La page de d√©tail pr√©sente une interface professionnelle inspir√©e d'un vrai document fiscal avec :

1. **üìä Header Contextuel** : Statut, √©ch√©ances, d√©lais
2. **üéõÔ∏è Actions Contextuelles** : Modifier, envoyer, marquer pay√©e
3. **üìÑ Aper√ßu PDF** : Int√©gration React PDF native
4. **üíæ Sauvegarde Intelligente** : PdfSaveButton avec Supabase
5. **üìß Workflow Email** : Int√©gr√© avec templates
6. **üîÑ Gestion Statuts** : Dropdown avec validation m√©tier

### Header Adaptatif par Statut

```tsx
// Headers contextuels selon le statut
{facture.statut === 'payee' ? (
    // ‚úÖ Facture pay√©e
    <div className="flex items-center justify-between">
        <div>
            <h3 className="font-semibold text-lg mb-1 text-green-700">‚úÖ Facture pay√©e</h3>
            <p className="text-sm text-gray-600">
                Cette facture a √©t√© pay√©e le {facture.date_paiement ? formatDateShort(facture.date_paiement) : 'N/A'}
            </p>
        </div>
        <div className="text-right">
            <div className="text-2xl font-bold text-green-600">
                {formatPrice(facture.montant_ttc)}
            </div>
            <div className="text-sm text-gray-500">
                Montant pay√©
            </div>
        </div>
    </div>
) : facture.statut === 'envoyee' ? (
    // üìß Facture envoy√©e
    <div className="flex items-center justify-between">
        <div>
            <h3 className="font-semibold text-lg mb-1 text-blue-700">üìß Facture envoy√©e</h3>
            <p className="text-sm text-gray-600">
                Cette facture a √©t√© envoy√©e au client et attend le paiement
            </p>
            <div className="flex items-center gap-4 mt-2 text-sm text-gray-500">
                <div className="flex items-center gap-1">
                    <Calendar className="h-4 w-4" />
                    <span>√âmise: {formatDateShort(facture.date_facture)}</span>
                </div>
                <div className="flex items-center gap-1">
                    <Clock className="h-4 w-4" />
                    <span className={isRetard() ? 'text-red-600 font-medium' : ''}>
                        √âch√©ance: {formatDateShort(facture.date_echeance)}
                    </span>
                </div>
            </div>
        </div>
        <div className="text-right">
            <div className="text-2xl font-bold text-blue-600">
                {formatPrice(facture.montant_ttc)}
            </div>
            <div className="text-sm text-gray-500">
                En attente de paiement
            </div>
        </div>
    </div>
) : facture.statut === 'en_retard' ? (
    // ‚ö†Ô∏è Facture en retard
    <div className="flex items-center justify-between">
        <div>
            <h3 className="font-semibold text-lg mb-1 text-red-700">‚ö†Ô∏è Facture en retard</h3>
            <p className="text-sm text-gray-600">
                Cette facture n'a pas √©t√© pay√©e dans les d√©lais
            </p>
            <div className="text-sm text-red-600 font-medium mt-1">
                {getDelaiPaiement()}
            </div>
        </div>
        <div className="text-right">
            <div className="text-2xl font-bold text-red-600">
                {formatPrice(facture.montant_ttc)}
            </div>
            <div className="text-sm text-red-500">
                Paiement en retard
            </div>
        </div>
    </div>
)}
```

### Calcul des D√©lais Intelligents

```tsx
// Calcul automatique des d√©lais et retards
const getDelaiPaiement = () => {
    const dateEcheance = new Date(facture.date_echeance);
    const aujourdhui = new Date();
    const diffTime = dateEcheance.getTime() - aujourdhui.getTime();
    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

    if (diffDays < 0) {
        return `En retard de ${Math.abs(diffDays)} jour${Math.abs(diffDays) > 1 ? 's' : ''}`;
    } else if (diffDays === 0) {
        return '√âch√©ance aujourd\'hui';
    } else {
        return `${diffDays} jour${diffDays > 1 ? 's' : ''} restant${diffDays > 1 ? 's' : ''}`;
    }
};

// D√©tection de retard
const isRetard = () => {
    return new Date(facture.date_echeance) < new Date() &&
        !['payee', 'annulee'].includes(facture.statut);
};
```

### Actions Contextuelles par Statut

```tsx
// Actions conditionnelles selon le statut de la facture
<div className="flex flex-wrap items-center gap-2">
    {/* Modification uniquement pour brouillons et en_attente */}
    {['brouillon', 'en_attente'].includes(facture.statut) && (
        <Button asChild className="h-10 px-4">
            <Link href={`/factures/${facture.id}/edit`}>
                <Edit className="mr-2 h-4 w-4" />
                Modifier
            </Link>
        </Button>
    )}

    {/* Envoi email pour tous sauf pay√©es et annul√©es */}
    {!['payee', 'annulee'].includes(facture.statut) && (
        <Button className="bg-green-600 hover:bg-green-700 h-10 px-4" asChild>
            <Link href={`/factures/${facture.id}/envoyer-email`}>
                <Send className="mr-2 h-4 w-4" />
                Envoyer par email
            </Link>
        </Button>
    )}

    {/* Marquer pay√©e uniquement pour les envoy√©es */}
    {facture.statut === 'envoyee' && (
        <Button className="bg-blue-600 hover:bg-blue-700 h-10 px-4" onClick={handleMarquerPayee}>
            <CheckCircle className="mr-2 h-4 w-4" />
            Marquer pay√©e
        </Button>
    )}
</div>
```

### Gestion des Statuts Dropdown

```tsx
// Options de statut avec validation m√©tier
const statutOptions = [
    { value: 'brouillon', label: 'Brouillon', icon: 'üìù' },
    { value: 'en_attente', label: 'En attente', icon: '‚è≥' },
    { value: 'envoyee', label: 'Envoy√©e', icon: 'üìß' },
    { value: 'payee', label: 'Pay√©e', icon: '‚úÖ' },
    { value: 'en_retard', label: 'En retard', icon: '‚ö†Ô∏è' },
    { value: 'annulee', label: 'Annul√©e', icon: '‚ùå' }
];

// Changement de statut avec validation
const handleStatutChange = (nouveauStatut: string) => {
    router.patch(`/factures/${facture.id}/changer-statut`, {
        statut: nouveauStatut
    }, {
        onSuccess: () => {
            toast.success(`Statut chang√© vers : ${formatStatut(nouveauStatut)}`);
        },
        onError: () => {
            toast.error('Erreur lors du changement de statut');
        }
    });
};

// Dropdown uniforme
<Select value={facture.statut} onValueChange={handleStatutChange}>
    <SelectTrigger className="w-full h-10 border-gray-300 hover:border-amber-400 bg-white transition-colors">
        <SelectValue placeholder="S√©lectionner un statut" />
    </SelectTrigger>
    <SelectContent>
        {statutOptions.map((option) => (
            <SelectItem key={option.value} value={option.value}>
                <span className="flex items-center gap-2">
                    <span>{option.icon}</span>
                    <span>{option.label}</span>
                </span>
            </SelectItem>
        ))}
    </SelectContent>
</Select>
```

### Int√©gration PDF Native

```tsx
// Modal d'aper√ßu PDF avec React PDF
const [isPdfModalOpen, setIsPdfModalOpen] = useState(false);

const handlePreviewPdf = () => {
    setIsPdfModalOpen(true);
};

// Bouton d'aper√ßu
<Button
    variant="outline"
    size="sm"
    className="h-10 px-4 bg-blue-50 border-blue-200 text-blue-700 hover:bg-blue-100"
    onClick={handlePreviewPdf}
>
    <Eye className="mr-2 h-4 w-4" />
    Aper√ßu PDF
</Button>

// PdfSaveButton pour sauvegarde Supabase
<PdfSaveButton
    pdfComponent={<FacturePdfPreview facture={facture} madinia={madinia} />}
    saveRoute={route('factures.save-react-pdf', facture.id)}
    filename={`${facture.numero_facture}.pdf`}
    type="facture"
    className="!bg-green-600 hover:!bg-green-700 active:!bg-green-800 focus:!border-green-900 focus:!ring-green-300"
>
    Sauvegarder
</PdfSaveButton>
```

### Format Invoice Professionnel

```tsx
// Layout style facture avec informations Madinia
<Card className="w-full max-w-5xl mx-auto bg-white shadow-lg">
    <CardContent className="p-12 lg:p-16">
        {/* Header avec logo et num√©ro */}
        <div className="flex justify-between items-start mb-8">
            <div>
                <div className="flex items-center gap-3 mb-4">
                    <div className="w-36 h-12 flex items-center justify-center">
                        <img
                            src="/logo/logo-1-small.svg"
                            alt="Logo"
                            className="h-10 dark:hidden"
                        />
                        <img
                            src="/logo/logo-1-small-darkmode.svg"
                            alt="Logo"
                            className="h-10 hidden dark:block"
                        />
                    </div>
                </div>
            </div>
            <div className="text-right">
                <div className={`px-4 py-2 rounded-lg inline-block mb-2 ${getStatusStyles(facture.statut)}`}>
                    <span className="text-sm font-medium">
                        {formatStatut(facture.statut)}
                    </span>
                </div>
                <h2 className="text-3xl font-bold text-gray-900">{facture.numero_facture}</h2>
            </div>
        </div>

        {/* Sections From et To comme vraie facture */}
        <div className="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
            {/* From section */}
            <div>
                <h3 className="text-sm font-semibold text-gray-700 mb-3">Facture de</h3>
                <div className="space-y-1">
                    <p className="font-semibold text-gray-900">
                        {madinia?.name || 'Madin.IA'}
                    </p>
                    {madinia?.adresse && (
                        <p className="text-gray-600">{madinia.adresse}</p>
                    )}
                    {madinia?.pays && (
                        <p className="text-gray-600">{madinia.pays}</p>
                    )}
                    {madinia?.email && (
                        <p className="text-gray-600">{madinia.email}</p>
                    )}
                    {madinia?.siret && (
                        <p className="text-gray-600">SIRET: {madinia.siret}</p>
                    )}
                </div>
            </div>

            {/* To section */}
            <div>
                <h3 className="text-sm font-semibold text-gray-700 mb-3">Facture √†</h3>
                <div className="space-y-1">
                    <p className="font-semibold text-gray-900">
                        {facture.client.prenom} {facture.client.nom}
                    </p>
                    {facture.client.entreprise && (
                        <p className="text-gray-600">
                            {facture.client.entreprise.nom_commercial || facture.client.entreprise.nom}
                        </p>
                    )}
                    <p className="text-gray-600">{facture.client.email}</p>
                    {facture.client.telephone && (
                        <p className="text-gray-600">{facture.client.telephone}</p>
                    )}
                </div>
            </div>
        </div>
    </CardContent>
</Card>
```

### Tableau des Lignes Professionnel

```tsx
// Tableau des lignes avec calculs automatiques
<div className="overflow-hidden rounded-lg border border-gray-200">
    <table className="w-full">
        <thead className="bg-gray-50">
            <tr>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                    #
                </th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Description
                </th>
                <th className="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Qt√©
                </th>
                <th className="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Prix unitaire
                </th>
                <th className="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Total
                </th>
            </tr>
        </thead>
        <tbody className="bg-white divide-y divide-gray-200">
            {facture.lignes && facture.lignes.length > 0 ? (
                facture.lignes
                    .sort((a, b) => a.ordre - b.ordre)
                    .map((ligne, index) => (
                        <tr key={ligne.id} className="hover:bg-gray-50">
                            <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                {ligne.ordre}
                            </td>
                            <td className="px-6 py-4 text-sm text-gray-900">
                                <div className="font-medium">
                                    {ligne.service?.nom || 'Service personnalis√©'}
                                </div>
                                <div className="text-gray-500 text-xs mt-1">
                                    {ligne.description_personnalisee || ligne.service?.description || 'Service personnalis√©'}
                                </div>
                                {ligne.service?.unite && (
                                    <div className="text-gray-400 text-xs mt-1">
                                        Unit√© : {formatUnite(ligne.service.unite, ligne.quantite)}
                                    </div>
                                )}
                            </td>
                            <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900 text-center">
                                {ligne.quantite}
                            </td>
                            <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900 text-right">
                                {formatPrice(ligne.prix_unitaire_ht)}
                            </td>
                            <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900 text-right font-medium">
                                {formatPrice(ligne.montant_ttc)}
                            </td>
                        </tr>
                    ))
            ) : (
                <tr>
                    <td colSpan={5} className="px-6 py-8 text-center text-gray-500">
                        Aucune ligne de facturation
                    </td>
                </tr>
            )}
        </tbody>
    </table>
</div>
```

## üîÑ Workflow Int√©gr√©

### Navigation Fluide

```mermaid
graph TD
    A[Liste Factures] -->|Clic ligne| B[D√©tail Facture]
    B -->|Bouton Modifier| C[Formulaire √âdition]
    B -->|Bouton Envoyer| D[Page Email]
    B -->|Bouton PDF| E[Aper√ßu PDF]
    B -->|Sauvegarde| F[PDF Supabase]
    
    A -->|Nouvelle facture| G[Formulaire Cr√©ation]
    A -->|Actions bulk| H[Suppression/Export]
    
    D -->|Envoi r√©ussi| I[Redirection Auto]
    C -->|Sauvegarde| B
    G -->|Cr√©ation| B
```

### Int√©gration avec Backend

1. **üìä Donn√©es temps r√©el** : Props Inertia avec relations compl√®tes
2. **üîÑ Actions Inertia** : PATCH/DELETE avec feedback toast
3. **üìß Workflow emails** : Int√©gration templates Blade
4. **üìÑ PDF React** : G√©n√©ration client + sauvegarde serveur
5. **üîî Notifications** : Toast Sonner pour feedback utilisateur

## üì± Responsive Design

### Breakpoints Adaptatifs

- **üì± Mobile (< 768px)** : 1 colonne, cards stack, actions condens√©es
- **üìü Tablet (768-1024px)** : 2-3 colonnes, navigation simplifi√©e  
- **üñ•Ô∏è Desktop (> 1024px)** : Grille compl√®te 6 colonnes, tous d√©tails

### Optimisations Mobile

```tsx
// Grid responsive pour m√©triques
<div className="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-6 gap-4">

// Actions responsive
<div className="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">

// Tableau responsive avec scroll horizontal
<div className="rounded-md border table-responsive">
    <Table>
        {/* ... contenu tableau ... */}
    </Table>
</div>
```

## üé® Design System Unifi√©

### Classes CSS G√©n√©riques

Les pages utilisent le syst√®me CSS g√©n√©ralis√© d'`app.css` :

- `.page-container` : Layout principal
- `.page-header` : En-t√™tes avec d√©grad√©
- `.card-elevated` : Cartes avec ombre
- `.badge-success/.badge-warning/.badge-error` : Badges contextuels
- `.table-responsive` : Tableaux adaptatifs
- `.action-button` : Boutons d'action uniformes

### Couleurs Th√©matiques

- **üîµ Bleu** : Total, envoy√©e, actions principales
- **üü¢ Vert** : Pay√©e, succ√®s, validation
- **üü† Orange** : En attente, avertissement
- **üî¥ Rouge** : En retard, erreur, urgence
- **üü£ Violet** : Annul√©e, archives
- **‚ö´ Gris** : Brouillon, inactif

## üìä Performance et Optimisation

### M√©morisation React

```tsx
// M√©triques calcul√©es avec useMemo
const metrics = useMemo(() => {
    // ... calculs complexes ...
}, [filteredFacturesByPeriod]);

// Pagination optimis√©e
const paginatedFactures = useMemo(() => {
    const startIndex = (currentPage - 1) * itemsPerPage;
    return filteredAndSortedFactures.slice(startIndex, startIndex + itemsPerPage);
}, [filteredAndSortedFactures, currentPage, itemsPerPage]);
```

### Lazy Loading

- **üìÑ PDF Modal** : Charg√© uniquement √† l'ouverture
- **üñºÔ∏è Images** : Loading diff√©r√© pour logos
- **üìä M√©triques** : Calcul √† la demande selon filtre p√©riode

## üîó Int√©grations

### API Routes

- `GET /factures` : Liste avec m√©triques
- `GET /factures/{id}` : D√©tail complet avec relations
- `PATCH /factures/{id}/changer-statut` : Changement statut
- `PATCH /factures/{id}/marquer-payee` : Marquer comme pay√©e
- `DELETE /factures/{id}` : Suppression avec v√©rifications

### Templates Email

- Liens directs vers `envoyer-email.tsx`
- Int√©gration avec `FactureClientMail` et `FactureAdminMail`
- Redirection automatique apr√®s envoi

### Syst√®me PDF

- **Aper√ßu** : PDFViewer React-PDF
- **Sauvegarde** : PdfSaveButton vers Supabase
- **Download** : PDFDownloadLink natif

## üìã R√©sum√© Module 3.1

### Caract√©ristiques Principales

1. **üìä Interface Compl√®te** : Liste + d√©tail avec toutes fonctionnalit√©s
2. **üéØ UX Optimis√©e** : Actions contextuelles, feedback imm√©diat
3. **üì± Responsive Design** : Adaptatif toutes plateformes
4. **üîÑ Workflow M√©tier** : Statuts, d√©lais, emails int√©gr√©s
5. **üé® Design Professionnel** : Style facture, couleurs th√©matiques
6. **‚ö° Performance** : M√©morisation, lazy loading, optimisations

### Diff√©rences vs Devis

- **üè∑Ô∏è Badges fiscaux** : 6 statuts vs 4 pour devis
- **üìÖ Gestion √©ch√©ances** : D√©lais automatiques, retards
- **üí∞ M√©triques avanc√©es** : Encaissements, p√©riode, analyse
- **üìÑ Format professionnel** : Layout facture vs devis
- **üîÑ Workflow paiement** : Marquer pay√©e, relances

Cette architecture garantit une interface utilisateur compl√®te et professionnelle pour la gestion des factures avec toutes les fonctionnalit√©s m√©tier n√©cessaires. Les composants sont optimis√©s, r√©utilisables et s'int√®grent parfaitement avec le backend Laravel.
